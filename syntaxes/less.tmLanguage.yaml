# yaml-language-server: $schema=https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json
name: Less
patterns:
  - include: '#variable-definition'
  - include: '#comment-block'
  - include: '#comment-line'
  - include: '#mixin-definition'
  - include: '#rule-each'
  - include: '#combinators'
  - include: '#selector'
  - include: '#at-rules'
  - include: '#rule-list'
  - match: ;
    name: punctuation.terminator.rule.less
repository:
  at-rules:
    patterns:
      - begin: \A(?:\xEF\xBB\xBF)?(?i:(?=\s*@charset\b))
        end: ;|(?=$)
        endCaptures:
          '0':
            name: punctuation.terminator.rule.less
        name: meta.at-rule.charset.less
        patterns:
          - captures:
              '1':
                name: keyword.control.at-rule.charset.less
              '2':
                name: punctuation.definition.keyword.less
            match: ((@)charset)(?=\s)
          - begin: '"'
            beginCaptures:
              '0':
                name: punctuation.definition.string.begin.less
            end: '"|$'
            endCaptures:
              '0':
                name: punctuation.definition.string.end.less
            name: string.quoted.double.less
            patterns:
              - begin: (?:\G|^)(?=(?:[^"])+$)
                end: $
                name: invalid.illegal.unclosed.string.css
      - begin: (?i)(?=@counter-style([\s'"{;]|/\*|$))
        end: (?<=})(?!\G)
        patterns:
          - begin: (?i)\G(@)counter-style
            beginCaptures:
              '0':
                name: keyword.control.at-rule.counter-style.less
              '1':
                name: punctuation.definition.keyword.less
            end: (?=\s*{)
            name: meta.at-rule.counter-style.header.less
            patterns:
              - include: '#comment-block'
              - include: '#escapes'
              - include: '#variables'
              - captures:
                  '0':
                    patterns:
                      - include: '#escapes'
                match: |-
                  (?x)
                  (?:[-a-zA-Z_]    | [^\x00-\x7F])     # First letter
                  (?:[-a-zA-Z0-9_] | [^\x00-\x7F]      # Remainder of identifier
                    |\\(?:[0-9a-fA-F]{1,6}|.)
                  )*
                name: variable.parameter.style-name.less
          - begin: '{'
            beginCaptures:
              '0':
                name: punctuation.section.property-list.begin.bracket.curly.less
            end: '}'
            endCaptures:
              '0':
                name: punctuation.section.property-list.end.bracket.curly.less
            name: meta.at-rule.counter-style.body.less
            patterns:
              - include: '#comment-block'
              - include: '#comment-line'
              - include: '#escapes'
              - include: '#rule-list-innards'
      - begin: (?i)((@)font-face)(?=\s*|{|/\*|$)
        beginCaptures:
          '1':
            name: keyword.control.at-rule.font-face.less
          '2':
            name: punctuation.definition.keyword.less
        end: (?!\G)
        name: meta.at-rule.font-face.less
        patterns:
          - include: '#comment-block'
          - include: '#escapes'
          - include: '#rule-list'
      - begin: (?i)((@)import)(?:\s+|$|(?=['"]|\(|/\*))
        beginCaptures:
          '1':
            name: keyword.control.at-rule.import.less
          '2':
            name: punctuation.definition.keyword.less
        end: ;
        endCaptures:
          '0':
            name: punctuation.terminator.rule.less
        name: meta.at-rule.import.less
        patterns:
          - begin: (?<=@import\s*)\(
            beginCaptures:
              '0':
                name: punctuation.definition.begin.bracket.round.less
            end: \)
            endCaptures:
              '0':
                name: punctuation.definition.end.bracket.round.less
            patterns:
              - match: \b(reference|inline|less|css|once|multiple|optional)\b
                name: support.constant.import.option.less
              - match: ','
                name: punctuation.separator.delimiter.less
          - begin: \G\s*(?=/\*)
            end: (?<=\*/)\s*
            patterns:
              - include: '#comment-block'
          - include: '#variable'
          - include: '#string'
          - include: '#url'
      - begin: (?i)(?=@(?:-(?:webkit|moz|o|ms)-)?keyframes([\s'"{;]|/\*|$))
        end: (?<=})(?!\G)
        patterns:
          - begin: (?i)\G(@)(?:-(?:webkit|moz|o|ms)-)?keyframes
            beginCaptures:
              '0':
                name: keyword.control.at-rule.keyframes.less
              '1':
                name: punctuation.definition.keyword.less
            end: (?=\s*{)
            name: meta.at-rule.keyframes.header.less
            patterns:
              - include: '#comment-block'
              - include: '#escapes'
              - include: '#variables'
              - captures:
                  '0':
                    patterns:
                      - include: '#escapes'
                match: |-
                  (?x)
                  (?:[-a-zA-Z_]    | [^\x00-\x7F])     # First letter
                  (?:[-a-zA-Z0-9_] | [^\x00-\x7F]      # Remainder of identifier
                    |\\(?:[0-9a-fA-F]{1,6}|.)
                  )*
                name: variable.parameter.keyframe-list.less
          - begin: '{'
            beginCaptures:
              '0':
                name: punctuation.section.keyframes.begin.bracket.curly.less
            end: '}'
            endCaptures:
              '0':
                name: punctuation.section.keyframes.end.bracket.curly.less
            name: meta.at-rule.keyframes.body.less
            patterns:
              - include: '#comment-block'
              - include: '#comment-line'
              - include: '#escapes'
              - include: '#interpolation'
              - captures:
                  '1':
                    name: entity.other.keyframe-offset.less
                  '2':
                    name: entity.other.keyframe-offset.percentage.less
                match: >-
                  (?xi)

                  (?<![\w-]) (from|to) (?![\w-])         # Keywords for 0% |
                  100%

                  |

                  ([-+]?(?:\d+(?:\.\d+)?|\.\d+)%)        # Percentile value
              - include: '#rule-list'
      - begin: (?i)(?=@media(\s|\(|/\*|$))
        end: (?<=})(?!\G)
        patterns:
          - begin: (?i)\G(@)media
            beginCaptures:
              '0':
                name: keyword.control.at-rule.media.less
              '1':
                name: punctuation.definition.keyword.less
            end: (?=\s*[{;])
            name: meta.at-rule.media.header.less
            patterns:
              - include: '#media-query-list'
          - begin: '{'
            beginCaptures:
              '0':
                name: punctuation.section.media.begin.bracket.curly.less
            end: '}'
            endCaptures:
              '0':
                name: punctuation.section.media.end.bracket.curly.less
            name: meta.at-rule.media.body.less
            patterns:
              - include: '#rule-each'
              - include: '#combinators'
              - include: '#inner-selector'
              - include: '#rule-list-innards'
              - include: '$self'
      - begin: (?i)((@)namespace)(?=[\s'";]|/\*|$)
        beginCaptures:
          '1':
            name: keyword.control.at-rule.namespace.less
          '2':
            name: punctuation.definition.keyword.less
        end: ;|(?=[@{])
        endCaptures:
          '0':
            name: punctuation.terminator.rule.less
        name: meta.at-rule.namespace.less
        patterns:
          - include: '#url'
          - captures:
              '1':
                patterns:
                  - include: '#comment-block'
              '2':
                name: entity.name.function.namespace-prefix.css
                patterns:
                  - include: '#escapes'
            match: >-
              (?xi)

              (?:\G|^|(?<=\s))

              (?=
                (?<=\s|^)                            # Starts with whitespace
                (?:[-a-zA-Z_]|[^\x00-\x7F])          # Then a valid identifier character
                |
                \s*                                  # Possible adjoining whitespace
                /\*(?:[^*]|\*[^/])*\*/               # Injected comment
              )

              (.*?)                                  # Grouped to embed
              #comment-block

              (
                (?:[-a-zA-Z_]    | [^\x00-\x7F])     # First letter
                (?:[-a-zA-Z0-9_] | [^\x00-\x7F]      # Remainder of identifier
                  |\\(?:[0-9a-fA-F]{1,6}|.)
                )*
              )
          - include: '#comment-block'
          - include: '#escapes'
          - include: '#string'
      - begin: (?i)(@)page(?=[\s:{]|/\*|$)
        captures:
          '0':
            name: keyword.control.at-rule.page.less
          '1':
            name: punctuation.definition.keyword.less
        end: (?=\s*($|[:{;]))
        name: meta.at-rule.page.less
        patterns:
          - include: '#rule-list'
      - begin: ^\s*((@)plugin)(?:\s+|$|(?=['"]))
        beginCaptures:
          '1':
            name: keyword.control.at-rule.plugin.less
          '2':
            name: punctuation.definition.keyword.less
        end: ;
        endCaptures:
          '0':
            name: punctuation.terminator.rule.less
        name: meta.at-rule.plugin.less
        patterns:
          - include: '#string'
      - begin: (?i)(?=@supports(\s|\(|/\*|$))
        end: (?<=})(?!\G)|(?=;)
        name: meta.at-rule.supports.less
        patterns:
          - begin: (?i)\G(@)supports
            beginCaptures:
              '0':
                name: keyword.control.at-rule.supports.less
              '1':
                name: punctuation.definition.keyword.less
            end: (?=\s*[{;])
            name: meta.at-rule.supports.header.less
            patterns:
              - include: 'source.css#feature-query-operators'
              - include: 'source.css#feature-query'
              - include: '#comment-block'
              - include: '#escapes'
          - begin: '{'
            beginCaptures:
              '0':
                name: punctuation.section.supports.begin.bracket.curly.less
            end: '}'
            endCaptures:
              '0':
                name: punctuation.section.supports.end.bracket.curly.less
            name: meta.at-rule.supports.body.less
            patterns:
              - include: $self
  combinators:
    patterns:
      - match: /deep/|>>>
        name: invalid.deprecated.combinator.less
      - match: '>>|>|\+_?|~'
        name: keyword.operator.combinator.less
  commas:
    match: ','
    name: punctuation.separator.list.comma.less
  comment-block:
    begin: /\*
    beginCaptures:
      '0':
        name: punctuation.definition.comment.less
    end: \*/
    endCaptures:
      '0':
        name: punctuation.definition.comment.less
    name: comment.block.less
  comment-line:
    begin: //
    beginCaptures:
      '0':
        name: punctuation.definition.comment.less
    end: \n
    name: comment.line.less
  functions:
    patterns:
      - begin: (?<![\w-])(if)(\()
        beginCaptures:
          '1':
              name: keyword.control.if.less
          '2':
            name: punctuation.section.function.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.section.function.end.bracket.round.less
        name: meta.function.if.less
        patterns:
          - include: '#conditional-operators'
          - match: \b(true|false)\b
            name: support.constant.boolean.less
          - include: '#property-values'
          - include: '#rule-list'
      - begin: (?<![\w-])(boolean)(\()
        beginCaptures:
          '1':
              name: keyword.control.boolean.less
          '2':
            name: punctuation.section.function.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.section.function.end.bracket.round.less
        name: meta.function.boolean.less
        patterns:
          - include: '#comparison-operators'
          - include: '#property-values'
      - begin: (?i)(?<![\w-])(calc)(\()
        beginCaptures:
          '1':
            name: support.function.calc.less
          '2':
            name: punctuation.section.function.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.section.function.end.bracket.round.less
        name: meta.function.calc.less
        patterns:
          - match: '[*/]|(?<=\s|^)[-+](?=\s|$)'
            name: keyword.operator.arithmetic.less
          - include: '#property-values'
      - begin: |-
          (?xi) (?<![\w-])
          (
            (?:-webkit-|-moz-|-o-)?        # Accept prefixed/historical variants
            (?:repeating-)?                # "Repeating"-type gradient
            (?:linear|radial|conic|svg)    # Shape | SVG
            -gradient
          )
          (\()
        beginCaptures:
          '1':
            name: support.function.gradient.less
          '2':
            name: punctuation.section.function.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.section.function.end.bracket.round.less
        name: meta.function.gradient.less
        patterns:
          - match: (?i)(?<![\w-])(from|to|at)(?![\w-])
            name: keyword.operator.gradient.less
          - include: '#property-values'
      - include: '#url'
      - begin: (?i)(?<![\w-])(var)(\()
        beginCaptures:
          '1':
            name: support.function.misc.less
          '2':
            name: punctuation.section.function.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.section.function.end.bracket.round.less
        name: meta.function.variable.less
        patterns:
          - name: variable.argument.less
            match: |-
              (?x)
              --
              (?:[-a-zA-Z_]    | [^\x00-\x7F])     # First letter
              (?:[-a-zA-Z0-9_] | [^\x00-\x7F]      # Remainder of identifier
                |\\(?:[0-9a-fA-F]{1,6}|.)
              )*
          - include: '#property-values'
      - begin: |-
          (?x) (?<![\w-])
          (
            # Built-in Functions
            escape|e|\%|replace
            | length|extract|range|each
            | ceil|floor|percentage|round|sqrt|abs|sin|asin|cos|acos|tan|atan|pi|pow|mod|min|max
            | is(?:number|string|color|keyword|url|pixel|em|percentage|unit|ruleset|defined)
            | rgba?|argb|hsla?|hsva?
            | hue|saturation|lightness|hsvhue|hsvsaturation|hsvvalue|red|green|blue|alpha|luma|luminance
            | saturate|desaturate|lighten|darken|fadein|fadeout|fade|spin|mix|tint|shade|greyscale|contrast
            | multiply|screen|overlay|softlight|hardlight|difference|exclusion|average|negation
          )
          (\()
        beginCaptures:
          '1':
              name: support.function.built-in.less
          '2':
            name: punctuation.section.function.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.section.function.end.bracket.round.less
        name: meta.function.built-in.less
        patterns:
          - include: '#property-values'
      - begin: (?i)(?<![\w-])([\w-]+)(\()
        beginCaptures:
          '1':
            name: support.function.misc.less
          '2':
            name: punctuation.section.function.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.section.function.end.bracket.round.less
        name: meta.function.misc.less
        patterns:
          - include: '#property-values'
  escapes:
    patterns:
      - match: \\[0-9a-fA-F]{1,6}
        name: constant.character.escape.codepoint.less
      - begin: \\$\s*
        end: ^(?<!\G)
        name: constant.character.escape.newline.less
      - match: \\.
        name: constant.character.escape.less
  interpolation:
    match: '(@{)([-a-zA-Z_][-a-zA-Z0-9_]*)(})'
    captures:
      '1':
        name: punctuation.definition.interpolation.begin.bracket.curly.less
      '3':
        name: punctuation.definition.interpolation.end.bracket.curly.less
    name: variable.other.interpolation.less
  conditional-operators:
    patterns:
      - include: '#comparison-operators'
      - include: '#logical-operators'
  comparison-operators:
    match: '!=|<=|>=|=|<|>'
    name: keyword.operator.comparison.less
  logical-operators:
    match: \b(not|or|and)\b
    name: keyword.operator.logical.less
  map:
    begin: \{
    beginCaptures:
      '0':
        name: punctuation.definition.map.begin.bracket.curly.less
    end: \}
    endCaptures:
      '0':
        name: punctuation.definition.map.end.bracket.curly.less
    name: meta.definition.variable.map.less
    patterns:
      - include: '#comment-block'
      - include: '#comment-line'
      - match: \b([\w-]+)\s*(:)
        captures:
          '1':
            name: support.type.map.key.less
          '2':
            name: punctuation.separator.key-value.less
      - match: ';'
        name: punctuation.separator.delimiter.less
      - include: '#map'
      - include: '#variable'
      - include: '#property-values'
  media-query:
    begin: \G
    end: (?=\s*[{;])
    patterns:
      - include: '#comment-block'
      - include: '#escapes'
      - include: 'source.css#media-types'
      - match: (?i)(?<=\s|^|,|\*/)(only|not)(?=\s|{|/\*|$)
        name: keyword.operator.logical.$1.media.less
      - match: (?i)(?<=\s|^|\*/|\))and(?=\s|/\*|$)
        name: keyword.operator.logical.and.media.less
      - match: ',(?:(?:\s*,)+|(?=\s*[;){]))'
        name: invalid.illegal.comma.less
      - include: '#commas'
      - begin: \(
        beginCaptures:
          '0':
            name: punctuation.definition.parameters.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.definition.parameters.end.bracket.round.less
        patterns:
          - include: 'source.css#media-features'
          - include: 'source.css#media-feature-keywords'
          - match: ':'
            name: punctuation.separator.key-value.less
          - match: '>=|<=|=|<|>'
            name: keyword.operator.comparison.less
          - captures:
              '1':
                name: constant.numeric.less
              '2':
                name: keyword.operator.arithmetic.less
              '3':
                name: constant.numeric.less
            match: (\d+)\s*(/)\s*(\d+)
            name: meta.ratio.less
          - include: '#variable'
          - include: 'source.css#numeric-values'
          - include: '#comment-block'
  media-query-list:
    begin: (?=\s*[^{;])
    end: (?=\s*[{;])
    patterns:
      - include: '#media-query'
  mixin-definition:
    begin: ([.#][-a-zA-Z0-9_]+)(?=\()
    beginCaptures:
      '1':
        name: entity.name.function.less
      '2':
        name: punctuation.definition.mixin.begin.bracket.round.less
    end: (?=\s*[;{])|(?=$)
    name: meta.rule.mixin.less
    patterns:
      - begin: \(
        beginCaptures:
          '0':
            name: punctuation.definition.mixin.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.definition.mixin.end.bracket.round.less
        name: meta.parameter-mixin.less
        patterns:
          - include: '#escapes'
          - include: '#variable'
          - begin: (:)
            beginCaptures:
              '1':
                name: punctuation.separator.key-value.less
            end: (?=\s*[,;\)])
            contentName: meta.parameter-value.less
            patterns:
              - include: '#property-values'
          - match: '\.\.\.'
            name: keyword.other.parameter-rest.less
          - include: '#property-values'
          - include: '#rule-list'
          - match: '[^''"),;@\s\\]+'
            name: string.unquoted.less
          - match: ';'
            name: punctuation.terminator.rule.less
      - include: '#rule-when'
  operators:
    match: '[*/]|(?<=\s|^)[-+](?=\s|$)'
    name: keyword.operator.arithmetic.less
  property-values:
    patterns:
      - include: '#variable'
      - include: '#commas'
      - include: '#comment-block'
      - include: '#escapes'
      - include: '#rule-mixin'
      - include: '#functions'
      - include: source.css#property-keywords
      - include: source.css#unicode-range
      - include: source.css#numeric-values
      - include: source.css#color-keywords
      - include: '#string'
      - match: '!\s*important(?![\w-])'
        name: keyword.other.important.less
      - begin: \(
        beginCaptures:
          '0':
            name: punctuation.definition.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.definition.end.bracket.round.less
        patterns:
          - match: \b(true|false)\b
            name: support.constant.boolean.less
          - include: '#operators'
          - include: '#conditional-operators'
          - include: '#property-values'
  rule-list:
    begin: '{'
    beginCaptures:
      '0':
        name: punctuation.section.property-list.begin.bracket.curly.less
    end: '}'
    endCaptures:
      '0':
        name: punctuation.section.property-list.end.bracket.curly.less
    name: meta.property-list.less
    patterns:
      - include: '#rule-each'
      - include: '#combinators'
      - include: '#inner-selector'
      - include: '#rule-list-innards'
      - include: '$self'
  rule-list-innards:
    patterns:
      - include: '#variable-definition'
      - include: '#comment-block'
      - include: '#comment-line'
      - include: '#escapes'
      - match: |-
          (?x) (?<![\w-])
          --
          (?:[-a-zA-Z_]    | [^\x00-\x7F])     # First letter
          (?:[-a-zA-Z0-9_] | [^\x00-\x7F]      # Remainder of identifier
            |\\(?:[0-9a-fA-F]{1,6}|.)
          )*
        name: variable.css
      - begin: (?<![-a-zA-Z])(?=[-a-zA-Z])
        end: $|(?![-a-zA-Z])
        patterns:
          - include: 'source.css#property-names'
          - match: >-
              (?<![@\w-])(?=[a-z]\w*-)(?:(?![A-Z])[\w-])+(?![(\w-])
            name: entity.name.tag.custom.less
      - begin: (:)\s*
        beginCaptures:
          '1':
            name: punctuation.separator.key-value.less
        end: \s*(;)|\s*(?=}|\))
        endCaptures:
          '1':
            name: punctuation.terminator.rule.less
        contentName: meta.property-value.less
        patterns:
          - include: '#comment-block'
          - include: '#property-values'
      - match: ;
        name: punctuation.terminator.rule.less
  rule-each:
    begin: (?<![@\w-])(each)(\()
    beginCaptures:
      '1':
          name: keyword.control.rule.each.less
      '2':
        name: punctuation.definition.begin.bracket.round.less
    end: \s*(\))
    endCaptures:
      '1':
        name: punctuation.definition.end.bracket.round.less
    name: meta.rule.each.less
    patterns:
      - begin: ([.#]\()
        beginCaptures:
          '0':
            name: punctuation.definition.anon-mixin.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.definition.anon-mixin.end.bracket.round.less
        patterns:
          - include: '#variables'
          - match: ','
            name: punctuation.separator.delimiter.less
      - include: '#property-values'
      - include: '#rule-list'
  rule-mixin:
    patterns:
      - begin: ([.#][\w-]+[.#\w-]*)(\()
        beginCaptures:
          '1':
            name: entity.name.function.less
          '2':
            name: punctuation.definition.mixin.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.definition.mixin.end.bracket.round.less
        name: meta.rule.mixin.less
        patterns:
          - include: '#variable'
          - include: '#property-values'
          - include: '#rule-list'
          - match: '[^''"),;\s]+'
            name: string.unquoted.less
          - match: ';'
            name: punctuation.terminator.rule.less
      - begin: ([.#][\w-]+[.#\w-]*)(\[)
        beginCaptures:
          '1':
            name: entity.name.function.less
          '2':
            name: punctuation.definition.map.begin.bracket.square.less
        end: \]
        endCaptures:
          '0':
            name: punctuation.definition.map.end.bracket.square.less
        name: meta.rule.mixin.map.less
        patterns:
          - include: '#variable'
          - match: '[^''"\],\s]+'
            name: variable.parameter.map.less
  rule-when:
    begin: (?<![@\w-])(when\b)\s*
    beginCaptures:
      '1':
        name: keyword.control.rule.when.less
    end: (?=\s*{)
    name: meta.rule.when.less
    patterns:
      - include: '#logical-operators'
      - begin: \(
        beginCaptures:
          '0':
            name: punctuation.definition.condition.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.definition.condition.end.bracket.round.less
        patterns:
          - include: '#conditional-operators'
          - include: '#variable'
          - match: \b(true|false)\b
            name: support.constant.boolean.less
          - include: '#property-values'
          - match: '[^''"),;\s]+'
            name: string.unquoted.less
      - include: '#commas'
  selector-namespace:
    captures:
      '1':
        name: entity.other.namespace-prefix.less
      '2':
        name: punctuation.separator.less
    match: >-
        (?x)

        (?:^|(?<=[\s,(};]))                    # Follows whitespace, comma, semicolon, or bracket

        (?!
          [-\w*]+
          \|
          (?!
              [-\[:.*\#a-zA-Z_]                # Make sure there's a selector to match
            | [^\x00-\x7F]
          )
        )

        (
          (?: [-a-zA-Z_]    | [^\x00-\x7F] )   # First letter
          (?: [-a-zA-Z0-9_] | [^\x00-\x7F]     # Remainder of identifier
            | \\(?:[0-9a-fA-F]{1,6}|.)
          )*
          |
          \*                                   # Universal namespace
        )?

        (\|)                                   # Namespace separator
  selector-class:
    captures:
      '1':
        name: punctuation.definition.entity.less
      '2':
        patterns:
          - include: '#escapes'
          - include: '#interpolation'
    match: |-
      (?x)
      (\.)                                   # Valid class-name
      (
        (?: [-a-zA-Z_0-9]|[^\x00-\x7F]       # Valid identifier characters
          | \\(?:[0-9a-fA-F]{1,6}|.)         # Escape sequence
          | @\{                              # Interpolation 
          | }                                # Possible end of interpolation
        )+
      )                                      # Followed by either:
      (?= $                                  # - End of the line
        | [\s,.\#)\[:{>+~|]                  # - Another selector
        | /\*                                # - A block comment
      )
    name: entity.other.attribute-name.class.less
  selector-id:
    captures:
      '1':
        name: punctuation.definition.entity.less
      '2':
        patterns:
          - include: '#escapes'
          - include: '#interpolation'
    match: |-
      (?x)
      (\#)
      (
        -?
        (?![0-9])
        (?:[-a-zA-Z0-9_]|[^\x00-\x7F]|\\(?:[0-9a-fA-F]{1,6}|.)|@\{|})+
      )
      (?=$|[\s,.\#)\[:{>+~|]|/\*)
    name: entity.other.attribute-name.id.less
  selector-attribute:
    begin: \[
    beginCaptures:
      '0':
        name: punctuation.definition.entity.begin.bracket.square.less
    end: \]
    endCaptures:
      '0':
        name: punctuation.definition.entity.end.bracket.square.less
    name: meta.attribute-selector.less
    patterns:
      - include: '#comment-block'
      - include: '#string'
      - captures:
          '1':
            name: storage.modifier.ignore-case.less
        match: (?<=["'\s]|^|\*/)\s*([iI])\s*(?=[\s\]]|/\*|$)
      - captures:
          '1':
            name: string.unquoted.attribute-value.less
            patterns:
              - include: '#escapes'
        match: (?x)(?<==)\s*((?!/\*)(?:[^\\"'\s\]]|\\.)+)
      - include: '#escapes'
      - match: '[~|^$*]?='
        name: keyword.operator.pattern.less
      - match: \|
        name: punctuation.separator.less
      - captures:
          '1':
            name: entity.other.namespace-prefix.less
            patterns:
              - include: '#escapes'
        match: |-
          (?x)
          # Qualified namespace prefix
          ( -?(?!\d)(?:[\w-]|[^\x00-\x7F]|\\(?:[0-9a-fA-F]{1,6}|.))+
          | \*
          )
          # Lookahead to ensure there's a valid identifier ahead
          (?=
            \| (?!\s|=|$|\])
            (?: -?(?!\d)
              |   [\\\w-]
              |   [^\x00-\x7F]
              )
          )
      - captures:
          '1':
            name: entity.other.attribute-name.css
            patterns:
              - include: '#escapes'
              - include: '#interpolation'
        match: |-
          (?x)
          (-?(?!\d)(?>[\w-]|[^\x00-\x7F]|\\(?:[0-9a-fA-F]{1,6}|.)|@\{|})+)
          \s*
          (?=[~|^\]$*=]|/\*)
  selector-pseudo-class:
    patterns:
      - begin: (?i)((:)extend)(\()
        beginCaptures:
          '1':
            name: keyword.control.extend.less
          '2':
            name: punctuation.definition.entity.less
          '3':
            name: punctuation.definition.extend.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.definition.extend.end.bracket.round.less
        patterns:
          - match: (?i)all
            name: support.constant.extend-all.less
          - include: '#variable'
          - include: '#selector-innards'
      - begin: (?i)((:)nth-(?:last-)?(?:child|of-type))(\()
        beginCaptures:
          '1':
            name: entity.other.attribute-name.pseudo-class.less
          '2':
            name: punctuation.definition.entity.less
          '3':
            name: punctuation.definition.pseudo-class.begin.bracket.round.less
        end: \)
        endCaptures:
          '0':
            name: punctuation.definition.pseudo-class.end.bracket.round.less
        patterns:
          - match: (?i)[+-]?(\d+n?|n)(\s*[+-]\s*\d+)?
            name: constant.numeric.less
          - match: (?i)even|odd
            name: support.constant.parity.less
          - include: '#variable'
      - include: source.css#pseudo-classes
      - include: source.css#pseudo-elements
      - include: source.css#functional-pseudo-classes
  selector-parent-suffix:
    captures:
      '1':
        patterns:
          - include: '#escapes'
          - include: '#interpolation'
    match: |-
      (?x)
      (?<=&)
      (
        -?
        (?![0-9])
        (?:[-a-zA-Z0-9_]|[^\x00-\x7F]|\\(?:[0-9a-fA-F]{1,6}|.)|@\{|})+
      )
      (?=$|[\s,.\#&)\[:{>+~|]|/\*)
    name: entity.other.attribute-name.parent-suffix.less
  selector:
    begin: |-
      (?x)
      (?=
        (?:\|)?                    # Possible anonymous namespace prefix
        (?:
          [-\[:.*\#&a-zA-Z_]       # Valid selector character
          |
          @\{                      # Interpolation
          |
          [^\x00-\x7F]             # Which can include non-ASCII symbols
          |
          \\                       # Or an escape sequence
          (?:[0-9a-fA-F]{1,6}|.)
        )
      )
    end: (?=\s*(?:[/{)]|@(?!\{)))
    name: meta.selector.less
    patterns:
      - include: '#selector-innards'
  selector-innards:
    patterns:
      - include: '#comment-block'
      - include: '#comment-line'
      - include: '#commas'
      - include: '#escapes'
      - include: '#combinators'
      - include: '#interpolation'
      - include: '#selector-namespace'
      - include: source.css#tag-names
      - match: \*
        name: entity.name.tag.wildcard.less
      - match: \&
        name: entity.name.tag.referece.less
      - include: '#selector-class'
      - include: '#selector-id'
      - include: '#selector-attribute'
      - include: '#selector-pseudo-class'
      - include: '#selector-parent-suffix'
      - include: '#rule-when'
      - match: |-
          (?x)
          (::?)
          (?=            # Custom pseudo-classes-elements names must:
            [a-z]        # - start with a lowercase ASCII letter,
            \w* -        # - contain at least one dash
          )
          (?:
            (?![A-Z])    # No uppercase ASCII letters are allowed
            [\w-]        # Allow any other word character or dash
          )+
          (?![(\w-])
        name: entity.name.tag.custom-pseudo-class-element.less
      - match: |-
          (?x) (?<![@\w-])
          (?=            # Custom element names must:
            [a-z]        # - start with a lowercase ASCII letter,
            \w* -        # - contain at least one dash
          )
          (?:
            (?![A-Z])    # No uppercase ASCII letters are allowed
            [\w-]        # Allow any other word character or dash
          )+
          (?![(\w-])
        name: entity.name.tag.custom.less
  inner-selector:
    patterns:
      - include: '#comment-block'
      - include: '#comment-line'
      - include: '#commas'
      - include: '#escapes'
      - include: '#combinators'
      - include: '#interpolation'
      - include: '#selector-namespace'
      - include: source.css#tag-names
      - match: \*
        name: entity.name.tag.wildcard.less
      - match: \&
        name: entity.name.tag.referece.less
      - include: '#selector-class'
      - include: '#selector-id'
      - include: '#selector-attribute'
      - include: '#selector-pseudo-class'
      - include: '#selector-parent-suffix'
      - include: '#rule-when'
      - match: >-
          (::?)(?=[a-z]\w*-)(?:(?![A-Z])[\w-])+(?![(\w-])
        name: entity.name.tag.custom-pseudo-class-element.less
  string:
    patterns:
      - match: (~)(?=['"])
        name: support.function.unquote.less
      - begin: '"'
        beginCaptures:
          '0':
            name: punctuation.definition.string.begin.css
        end: '"'
        endCaptures:
          '0':
            name: punctuation.definition.string.end.css
        name: string.quoted.double.css
        patterns:
          - match: \\([0-9A-Fa-f]{1,6}|.)
            name: constant.character.escape.css
          - include: '#interpolation'
      - begin: "'"
        beginCaptures:
          '0':
            name: punctuation.definition.string.begin.css
        end: "'"
        endCaptures:
          '0':
            name: punctuation.definition.string.end.css
        name: string.quoted.single.css
        patterns:
          - match: \\([0-9A-Fa-f]{1,6}|.)
            name: constant.character.escape.css
          - include: '#interpolation'
  variable:
    patterns:
      - include: '#variables'
      - include: '#interpolation'
  variable-definition:
    patterns:
      - begin: (?=@(?!page)[\w-]+\s*:)
        end: (?<=})|(;)
        endCaptures:
          '1':
            name: punctuation.terminator.rule.less
        patterns:
          - match: (@[\w-]+)(?=\s*:)
            name: variable.other.less
          - begin: ':'
            beginCaptures:
              '0':
                name: keyword.other.punctuation.separator.key-value.less
            end: (?<=})|(?=;)
            patterns:
              - include: '#comment-block'
              - include: '#map'
              - include: '#property-values'
              - include: '#variable'
      - captures:
          '1':
            name: variable.other.call.less
          '2':
            name: punctuation.definition.variable-call.bracket.round.less
        match: (@[-a-zA-Z_][-a-zA-Z0-9_]*)(\(\))
  variables:
    patterns:
      - begin: (@[-a-zA-Z_][-a-zA-Z0-9_]*)(\[)
        beginCaptures:
          '1':
            name: variable.other.less
          '2':
            name: punctuation.definition.map.begin.bracket.square.less
        end: \]
        endCaptures:
          '0':
            name: punctuation.definition.map.end.bracket.square.less
        name: meta.definition.variable.map.less
        patterns:
          - include: '#variables'
          - match: '[^''",\]\s]+'
            name: variable.parameter.map.less
      - match: (@@?[-a-zA-Z_][-a-zA-Z0-9_]*)
        name: variable.other.less
      - match: (\$[-a-zA-Z_][-a-zA-Z0-9_]*)
        name: variable.less
  url:
    begin: (?i)(?<![\w@-])(url)(\()
    beginCaptures:
      '1':
        name: support.function.url.less
      '2':
        name: punctuation.section.function.begin.bracket.round.less
    end: \)
    endCaptures:
      '0':
        name: punctuation.section.function.end.bracket.round.less
    name: meta.function.url.less
    patterns:
      - match: '[^''")\s]+'
        name: variable.parameter.url.less
      - include: '#string'
      - include: '#comment-block'
      - include: '#escapes'
scopeName: source.css.less
